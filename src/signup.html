<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sign Up | Neotropic</title>

  <!-- Tailwind CSS -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
  />

  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&family=Rajdhani:wght@300;400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <!-- Custom CSS (Optional) -->
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="animations.css" />

  <!-- Inline fallback styling -->
  <style>
    body {
      font-family: 'Rajdhani', sans-serif;
      background-color: #0f172a; /* Dark background */
      color: #1a3150;
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    input {
      color: #2b9973;
    }
    input::placeholder {
      color: #611717;
    }
    .font-orbitron {
      font-family: 'Orbitron', sans-serif;
    }
    .glass-nav,
    .glassmorphism-card {
      background: rgba(30, 41, 59, 0.4);
      backdrop-filter: blur(8px);
    }

    /* Alert styles */
    .alert {
      padding: 12px;
      border-radius: 4px;
      margin-bottom: 15px;
    }
    .alert-error {
      background-color: rgba(220, 38, 38, 0.3);
      border: 1px solid #dc2626;
      color: #fecaca;
    }
    .alert-success {
      background-color: rgba(5, 150, 105, 0.3);
      border: 1px solid #059669;
      color: #a7f3d0;
    }
    .alert-info {
      background-color: rgba(37, 99, 235, 0.3);
      border: 1px solid #2563eb;
      color: #dbeafe;
    }
    .hidden {
      display: none;
    }

    /* ----------------------------------------
       Z-Index & Pointer-Events Fix
       ---------------------------------------- */

    /* Background elements should not intercept clicks */
    .neon-grid, .floating-cube {
      pointer-events: none; /* ADDED */
    }

    /* Ensure the signup card is on top and clickable */
    .glassmorphism-card {
      position: relative;
      z-index: 10;        /* ADDED */
      pointer-events: auto; /* ADDED */
    }
  </style>
</head>

<body class="bg-gradient-to-br from-gray-900 via-indigo-900 to-black min-h-screen text-white font-rajdhani">
  <!-- Navigation -->
  <nav id="navbar" class="glass-nav fixed w-full z-50 p-4">
    <div class="container mx-auto flex justify-between items-center">
      <a href="/" class="logo-container">
        <h1 class="text-3xl font-orbitron font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-600">
          NEOTROPIC
        </h1>
      </a>
      <div class="hidden md:flex space-x-4">
        <a href="home.html" class="nav-link">Gallery</a>
        <a href="upload.html" class="nav-link">Upload</a>
      </div>
      <div class="auth-buttons">
        <a href="login.html" id="loginBtn" class="cyber-button mr-2">
          <span>Login</span>
          <i></i>
        </a>
        <a href="signup.html" id="signupBtn" class="cyber-button-secondary">
          <span>Sign Up</span>
          <i></i>
        </a>
        <button id="logoutBtn" class="cyber-button-danger hidden">
          <span>Logout</span>
          <i></i>
        </button>
      </div>
      <div class="md:hidden">
        <button id="mobileMenuBtn" class="text-white">
          <svg class="w-6 h-6" fill="none" stroke="currentColor"
               viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
    </div>
    <div id="mobileMenu" class="glass-menu hidden md:hidden absolute w-full left-0 right-0 mt-4 p-4">
      <a href="home.html" class="block py-2 px-4 hover:bg-indigo-900 rounded">Gallery</a>
      <a href="upload.html" class="block py-2 px-4 hover:bg-indigo-900 rounded">Upload</a>
    </div>
  </nav>

  <!-- Sign Up Form Section -->
  <section class="min-h-screen flex items-center justify-center px-4 py-20">
    <!-- Possibly your background neon-grid -->
    <div class="neon-grid"></div>

    <div class="relative">
      <div class="glassmorphism-card p-8 rounded-2xl max-w-md w-full mx-auto">
        <div class="text-center mb-8">
          <h2 class="text-3xl font-orbitron font-bold mb-2 text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-600">
            SIGN UP
          </h2>
          <p class="text-blue-200">Join the dimensional collective</p>
        </div>

        <div id="signupAlert" class="hidden alert"></div>

        <form id="signupForm">
          <div class="mb-6">
            <label for="username" class="block text-blue-300 mb-2">Username</label>
            <input
              type="text"
              id="username"
              class="w-full p-2 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
              placeholder="Choose a username"
              required
            />
          </div>

          <div class="mb-6">
            <label for="email" class="block text-blue-300 mb-2">Email Address</label>
            <input
              type="email"
              id="email"
              class="w-full p-2 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
              placeholder="you@example.com"
              required
            />
          </div>

          <div class="mb-6">
            <label for="password" class="block text-blue-300 mb-2">Password</label>
            <input
              type="password"
              id="password"
              class="w-full p-2 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
              placeholder="Create a password"
              minlength="6"
              required
            />
            <p class="mt-1 text-xs text-blue-300">
              Password must be at least 6 characters
            </p>
          </div>

          <div class="mb-6">
            <label for="confirmPassword" class="block text-blue-300 mb-2">Confirm Password</label>
            <input
              type="password"
              id="confirmPassword"
              class="w-full p-2 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
              placeholder="Confirm your password"
              required
            />
          </div>

          <div class="flex items-center mb-6">
            <input type="checkbox" id="terms" class="mr-2" required />
            <label for="terms" class="text-blue-300">
              I agree to the
              <a href="#" class="text-blue-400 hover:underline">Terms &amp; Conditions</a>
            </label>
          </div>

          <button
            type="submit"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white p-2 rounded font-semibold"
          >
            CREATE ACCOUNT
          </button>
        </form>

        <div class="mt-6 text-center">
          <p>
            Already have an account?
            <a href="login.html" class="text-blue-400 hover:underline">Login</a>
          </p>
        </div>
      </div>

      <div class="absolute -z-10 top-0 left-0 w-full h-full filter blur-sm">
        <!-- If you have floating cubes or other design elements -->
        <div class="floating-cube scale-75 translate-x-10"></div>
        <div class="floating-cube scale-50 -translate-x-32 translate-y-20"></div>
      </div>
    </div>
  </section>

  <!-- Import your Supabase client -->
  <script type="module">
    import { supabase } from "../supabase.js"; // Adjust path if needed

    // A helper to show/hide alerts
    function showAlert(message, type = "error") {
      const signupAlert = document.getElementById("signupAlert");
      if (!signupAlert) return;
      signupAlert.textContent = message;
      signupAlert.classList.remove("hidden", "alert-success", "alert-error", "alert-info");

      if (type === "success") {
        signupAlert.classList.add("alert-success");
      } else if (type === "info") {
        signupAlert.classList.add("alert-info");
      } else {
        // Default to error
        signupAlert.classList.add("alert-error");
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      const signupForm = document.getElementById("signupForm");
      const usernameInput = document.getElementById("username");
      const emailInput = document.getElementById("email");
      const passwordInput = document.getElementById("password");
      const confirmPasswordInput = document.getElementById("confirmPassword");

      signupForm.addEventListener("submit", async (event) => {
        event.preventDefault();

        const username = usernameInput.value.trim();
        const email = emailInput.value.trim();
        const password = passwordInput.value;
        const confirmPassword = confirmPasswordInput.value;

        // Basic validation
        if (!username || !email || !password || !confirmPassword) {
          showAlert("Please fill in all fields.");
          return;
        }
        if (password !== confirmPassword) {
          showAlert("Passwords do not match.");
          return;
        }

        // 1) Sign up with Supabase Auth
        showAlert("Creating your account...", "info");
        const { data, error } = await supabase.auth.signUp({
          email,
          password
        });

        if (error) {
          showAlert("Signup failed: " + error.message);
          return;
        }

        // 2) (Optional) Insert extra profile info into your 'users' table
        try {
          const { data: insertData, error: insertError } = await supabase
            .from("users")
            .insert([
              {
                email,
                username
              }
            ]);
          if (insertError) {
            console.error("Profile insert error:", insertError.message);
          }
        } catch (err) {
          console.error("Profile insert exception:", err);
        }

        // 3) Show success message
        showAlert("Account created! Check your email for confirmation.", "success");

        // Optionally redirect after a few seconds:
        // setTimeout(() => {
        //   window.location.href = "/login";
        // }, 2000);
      });
    });
  </script>

  <script>
    // Mobile menu toggle
    const mobileMenuBtn = document.getElementById("mobileMenuBtn");
    const mobileMenu = document.getElementById("mobileMenu");

    if (mobileMenuBtn && mobileMenu) {
      mobileMenuBtn.addEventListener("click", () => {
        mobileMenu.classList.toggle("hidden");
      });
    }
  </script>
</body>
</html>
